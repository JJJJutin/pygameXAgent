# 現代顯示系統指南

## 概述

這份文檔描述了 Nyanko Game 的現代顯示系統，它提供了智能解析度支援、完美的全螢幕體驗，以及現代 Galgame 標準的 Full HD (1920x1080) 支援。

## 主要特色

### 🎯 智能解析度支援

- **自動偵測**: 系統會自動偵測螢幕的原生解析度
- **多解析度相容**: 支援從 1280x720 到 1920x1080 的各種解析度
- **完美匹配**: 當螢幕解析度與遊戲解析度匹配時，提供最佳性能
- **智能縮放**: 當解析度不匹配時，使用高品質縮放並保持縱橫比

### 🖥️ 現代全螢幕體驗

- **原生解析度支援**: 全螢幕模式使用螢幕的原生解析度
- **像素完整縮放**: 保持圖像的銳利度和清晰度
- **居中顯示**: 解析度不匹配時，遊戲畫面居中顯示
- **黑邊填充**: 優雅的黑邊處理，不會拉伸或扭曲畫面

### 🎮 精確的滑鼠控制

- **座標轉換**: 自動轉換螢幕座標到遊戲座標
- **區域偵測**: 準確偵測滑鼠是否在遊戲區域內
- **完美相容**: 所有遊戲功能在任何解析度下都能正常工作

## 技術規格

### 預設解析度

```python
SCREEN_WIDTH = 1920   # Full HD 寬度
SCREEN_HEIGHT = 1080  # Full HD 高度
```

### 支援的解析度

1. **1920x1080** - Full HD (推薦)
2. **1680x1050** - WSXGA+
3. **1600x900** - HD+
4. **1440x900** - WXGA+
5. **1366x768** - WXGA (筆電標準)
6. **1280x720** - HD Ready (最低需求)

### 圖片資源規格

- **背景圖片**: 1920x1080 (原生 Full HD)
- **人物立繪**: 170x283 (自動縮放)
- **UI 元素**: 適應性縮放

## 使用方式

### 遊戲內控制

- **F11**: 切換全螢幕/視窗模式
- **F1**: 切換除錯資訊顯示
- **F2**: 切換像素完整縮放模式
- **F3**: 顯示詳細解析度資訊 (除錯模式)
- **F4**: 自動調整到最佳解析度 (除錯模式，僅視窗模式)

### 程式設計介面

#### 初始化顯示管理器

```python
from systems.modern_display_manager import ModernDisplayManager

display_manager = ModernDisplayManager()
screen = display_manager.initialize_display(fullscreen=False)
```

#### 渲染畫面

```python
def render_game_content(surface):
    # 在這裡渲染遊戲內容
    surface.fill(Colors.BACKGROUND_COLOR)
    # ... 其他渲染代碼

display_manager.render_frame(screen, render_game_content)
```

#### 滑鼠座標轉換

```python
# 取得轉換後的滑鼠位置
raw_pos = pygame.mouse.get_pos()
game_pos = display_manager.transform_mouse_position(raw_pos)

# 檢查是否在遊戲區域內
if display_manager.is_position_in_game_area(raw_pos):
    # 處理遊戲內的滑鼠事件
    pass
```

#### 切換全螢幕

```python
screen = display_manager.toggle_fullscreen(screen)
```

#### 獲取顯示資訊

```python
info = display_manager.get_display_info()
print(f"當前解析度: {info['current_resolution']}")
print(f"是否需要縮放: {info['needs_scaling']}")
print(f"縮放比例: {info['scale_factor']}")
```

## 最佳化建議

### 對於開發者

1. **使用 Full HD 素材**: 為最佳畫質，建議使用 1920x1080 的背景圖片
2. **測試多解析度**: 使用 `scripts/test_modern_display.py` 測試不同解析度
3. **檢查座標轉換**: 確保所有滑鼠事件都經過座標轉換
4. **優化渲染**: 在需要縮放的情況下，避免過於複雜的渲染

### 對於玩家

1. **建議解析度**: 如果系統支援，建議使用 1920x1080 解析度
2. **全螢幕體驗**: 全螢幕模式提供最佳的沉浸體驗
3. **視窗模式**: 在多工作業時，視窗模式更加方便
4. **效能考量**: 較高的解析度需要更好的顯卡效能

## 與其他 Galgame 的比較

### 現代標準

- **解析度**: 1920x1080 已成為現代 Galgame 的標準
- **縱橫比**: 16:9 寬螢幕是主流選擇
- **全螢幕**: 完美的全螢幕支援是必需功能

### 相容性

- **舊螢幕**: 仍然支援 1366x768 等較舊解析度
- **高解析度**: 為未來的 4K 螢幕預留了擴展性
- **多平台**: 系統設計考慮了不同平台的差異

## 故障排除

### 常見問題

#### 問題：遊戲畫面顯示不完整

**解決方案**：

1. 檢查螢幕解析度設定
2. 嘗試切換全螢幕模式 (F11)
3. 在除錯模式下檢查解析度資訊 (F3)

#### 問題：滑鼠點擊位置不準確

**解決方案**：

1. 確認座標轉換系統是否正常工作
2. 檢查是否在遊戲區域內點擊
3. 重新啟動遊戲以重置顯示設定

#### 問題：全螢幕模式下畫面模糊

**解決方案**：

1. 啟用像素完整縮放 (F2)
2. 檢查顯卡驅動程式是否最新
3. 調整顯示器的銳利度設定

#### 問題：效能問題

**解決方案**：

1. 降低解析度 (使用 F4 自動調整)
2. 關閉像素完整縮放以使用更快的算法
3. 使用視窗模式而非全螢幕

### 除錯資訊

在除錯模式下 (`DebugSettings.DEBUG_MODE = True`)，按 F1 可以顯示：

- 當前 FPS
- 解析度資訊
- 縮放狀態
- 滑鼠座標轉換
- 像素完整縮放狀態

## 未來擴展

### 計劃中的功能

1. **動態解析度調整**: 遊戲執行期間調整解析度
2. **多顯示器支援**: 支援多顯示器設定
3. **HDR 支援**: 為支援 HDR 的顯示器提供更豐富的色彩
4. **可變更新率**: 支援高更新率顯示器

### API 擴展

1. **自定義縮放算法**: 允許開發者定義縮放方式
2. **渲染插件**: 支援自定義渲染效果
3. **效能分析**: 內建效能分析工具

## 結論

現代顯示系統為 Nyanko Game 提供了符合現代標準的顯示體驗，同時保持了良好的相容性和效能。無論是在 Full HD 顯示器上享受最佳畫質，還是在較舊的螢幕上保持流暢遊戲，系統都能自動適應並提供最佳體驗。
