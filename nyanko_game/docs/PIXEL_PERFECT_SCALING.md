# 像素完整縮放功能說明

## 概述

本系統實現了像素完整縮放功能，確保圖片在全螢幕模式下放大時保持銳利的像素邊緣，避免模糊效果。

## 功能特點

### 1. 像素完整縮放

- **整數倍縮放**: 當縮放比例接近整數倍時，使用精確的像素複製算法
- **最近鄰算法**: 對於非整數倍縮放，使用最近鄰算法避免插值模糊
- **性能優化**: 針對常見縮放情況進行了性能優化

### 2. 動態切換

- **F2 鍵切換**: 在遊戲中按 F2 鍵可以即時切換像素完整縮放開關
- **除錯資訊**: 在除錯模式下顯示當前縮放模式狀態
- **配置設定**: 可在設定檔中預設開啟或關閉

### 3. 適用範圍

- **背景圖片**: 客廳等場景背景使用像素完整縮放
- **角色立繪**: にゃんこ等角色圖片使用像素完整縮放
- **全螢幕渲染**: 整個遊戲畫面在全螢幕模式下使用像素完整縮放

## 使用方法

### 配置設定

在 `config/settings.py` 中：

```python
class ImageScaling:
    USE_PIXEL_PERFECT_SCALING = True  # 啟用像素完整縮放
    PIXEL_PERFECT_FILTER = True       # 使用最近鄰過濾
```

### 遊戲內控制

- **F1**: 切換除錯資訊顯示
- **F2**: 切換像素完整縮放模式
- **F11**: 切換全螢幕模式

### 除錯資訊

在除錯模式下，螢幕左上角會顯示：

- FPS
- 當前場景
- 顯示模式（視窗/全螢幕）
- 解析度資訊
- **像素完整縮放狀態 (ON/OFF)**

## 技術實現

### 縮放算法選擇

1. **整數倍縮放**: 當縮放比例為整數倍時，使用像素複製
2. **非整數縮放**: 根據設定選擇最近鄰或平滑縮放
3. **性能考量**: 避免逐像素操作，使用 pygame 原生功能

### 應用位置

- `ImageManager.get_scaled_image()`: 一般圖片縮放
- `ImageManager.get_scaled_character_image()`: 角色圖片縮放
- `EnhancedLivingRoomScene.render()`: 背景縮放
- `GameEngine.render()`: 全螢幕渲染縮放

## 效果對比

### 像素完整縮放 ON

- ✅ 圖片邊緣銳利清晰
- ✅ 像素藝術風格保持
- ✅ 沒有模糊效果
- ⚠️ 可能出現鋸齒狀邊緣

### 像素完整縮放 OFF

- ✅ 邊緣平滑
- ✅ 適合照片風格圖片
- ⚠️ 像素藝術可能失去銳利感
- ⚠️ 細節可能變模糊

## 建議使用場景

### 適合開啟像素完整縮放

- 像素藝術風格的遊戲
- 低解析度的復古遊戲
- 需要保持銳利邊緣的 UI 元素
- 文字和圖示

### 適合關閉像素完整縮放

- 照片風格的背景
- 需要平滑過渡的圖像
- 高解析度的現代圖像
- 需要柔和效果的場景

## 性能考量

### 優化措施

- 避免不必要的像素級操作
- 重用縮放結果
- 使用 pygame 原生功能
- 智能選擇縮放算法

### 性能影響

- 整數倍縮放: 性能影響極小
- 非整數縮放: 輕微性能影響
- 全螢幕模式: 一次性處理，影響可控

## 疑難排解

### 圖片模糊

- 確認像素完整縮放已開啟 (F2 切換)
- 檢查原圖解析度是否過低
- 確認縮放比例是否合理

### 圖片有鋸齒

- 這是像素完整縮放的正常現象
- 可以關閉像素完整縮放獲得平滑效果
- 或使用更高解析度的原圖

### 性能問題

- 檢查是否在高頻率下重複縮放
- 考慮預先縮放並快取結果
- 降低目標解析度

## 更新記錄

### 2025-08-01

- ✅ 實現基本像素完整縮放功能
- ✅ 添加 F2 快捷鍵切換功能
- ✅ 整合到圖片管理器和場景渲染
- ✅ 添加除錯資訊顯示
- ✅ 創建測試腳本

### 未來計劃

- 🔄 添加縮放結果快取機制
- 🔄 支援更多縮放算法選項
- 🔄 優化大圖片的縮放性能
- 🔄 添加圖片預處理選項
